/*! arenajs - v0.1.0 - 2014-11-21
* https://github.com/jnylin/arena
* Copyright (c) 2014 Jakob Nylin; Licensed GPL */
function CatalogueRecord(a,b){this.element=a,this.subElements={title:$(".arena-"+b+"-title span:not(.arena-result-item-number)",this.element),originalTitle:$(".arena-detail-original .arena-value",this.element),author:$(".arena-"+b+"-author .arena-value",this.element),publisher:$(".arena-record-publisher .arena-value",this.element),year:$(".arena-"+b+"-year .arena-value",this.element),isbns:$(".arena-"+b+"-isbn .arena-value",this.element),media:$(".arena-"+b+"-media .arena-value",this.element),lang:$(".arena-"+b+"-language .arena-value",this.element)};var c,d,e,f,g,h,i,j,k,l=new RegExp("[0-9]{4}","i");switch(c=this.subElements.title.text().trim(),e=this.subElements.author.text(),f=this.subElements.publisher.text(),g=this.subElements.year.text(),j=this.subElements.media.text(),k=this.subElements.lang.text().trim(),b){case"record":h=this.subElements.isbns.text().split(", ");break;case"detail":h=[],$(this.subElements.isbns).each(function(){h.push($(this).text().trim())})}if(h)for(var m=0;m<h.length;m++){var n=h[m].replace(/-/g,"");if(13===n.length){i=n;break}}this.title=new Title(c,d),e&&(this.author={inverted:this.subElements.author.text(),lastname:this.subElements.author.text().split(",")[0].trim(),firstname:this.subElements.author.text().split(",")[1].substring(1).trim()}),f&&(this.publisher=f),g&&(this.year=l.exec(g)),j&&(this.media=j),k&&(this.lang=k),i&&(this.isbn=i),this.getSelector=function(){return b},console.log(this)}function SearchResult(){this.init(),Wicket.Ajax.registerPostCallHandler(function(){this.init()})}function Smakprov(a,b){var c=this;this.isbn=a,$.getJSON("/smakprov/v1/records?isbn="+this.isbn,c.callback(this,b))}function Title(a,b){var d,e,f,g,h,i;g=a,b=b||g,console.log("ti = "+g),console.log(g),console.log("ti.search = "+g.search),d=g.search("\\["),e=g.search(" :"),c=g.search("/"),f=g.search("\\[?(P\\.|Season|Series)"),e>-1&&(e+=1),c>-1&&(c+=2),h="",e>-1&&(e+=2,h=c>-1?g.substr(e,c-e-3):f>-1?g.substr(e,f-e-1):g.substr(e),h=h.replace(/[\[\]]/g,"")),i="",f>-1&&(a=g.substr(f),console.log(a),i=a.substr(a.search(/[0-9]/)),i=i.replace("]",""),a="",-1===i&&(i="")),d===f&&(d=-1),d>-1&&c>d?g=g.substr(0,d-1):e>-1&&(-1===c||c>e)?g=g.substr(0,e-3):c>-1?g=g.substr(0,c-3):f>-1&&(g=g.substr(0,f-1)),this.main=g,this.sub=h,this.original=b,this.part=i}function convert10to13(a){var b="978",c=b.concat(a.substr(0,9)),d=c.split(""),e=0,f=0;for(e=0;e<d.length;e++){var g=3;e%2===0&&(g=1,f+=d[e]*g)}return cdigit=10-f%10,c+cdigit}function convert13to10(a){var b=a.substr(3,9),c=b.split(""),d=0,e=10,f=0;for(d=0;d<c.length;d++,e--)f+=c[d]*e;return cdigit=11-f%11,11===cdigit&&(cdigit=0),10===cdigit&&(cdigit="X"),b+cdigit}function truncate(a,b,c){if("undefined"==typeof b)var b=100;if("undefined"==typeof c)var c="[...]";if(a.length<b)return a;for(var d=b-1;" "!==a.charAt(d);d--)b--;return a.substr(0,b)+c}CatalogueRecord.prototype.decorate=function(){},CatalogueRecord.prototype.hideField=function(a){$(".arena-"+this.getSelector()+"-"+a).hide()},CatalogueRecord.prototype.removeMediumFromTitle=function(){var a=this.subElements.title;a.text(a.text().replace(/\[.*\] ([\/:])/,"$1"))},CatalogueRecord.prototype.truncateTitle=function(){this.subElements.title.html(truncate(this.title.main+" "+this.title.part,30))},CatalogueRecord.prototype.getSmakprov=function(a){new Smakprov(this.isbn,a)},SearchResult.prototype.init=function(){$(".arena-library-record").each(function(){var a=new CatalogueRecord(this,"record");a.truncateTitle(),a.hideField("isbn")})},SearchResult.prototype.smakprov=function(){},SearchResult.prototype.dvdCovers=function(){},Smakprov.prototype.callback=function(a,b){return function(c){if(c.length>0)switch(console.log("type = "+b),console.log("smakprov på "+a.getUrl()),b){case"detail":appendExternalRes(a.getUrl(),"Smakprov","Läs ett smakprov av boken","_blank","btnRead");break;case"list":}}},Smakprov.prototype.getUrl=function(){return"http://www.smakprov.se/smakprov.php?isbn="+this.isbn+"&l=vimmerby"};