/*! arenajs - v0.1.0 - 2014-11-23
* https://github.com/jnylin/arena
* Copyright (c) 2014 Jakob Nylin; Licensed GPL */
function CatalogueRecord(a,b){var c,d,e,f,g,h,i,j,k,l,m=new RegExp("[0-9]{4}","i");switch(this.view=b,b){case"detail":c="detail";break;case"list":c="record"}switch(this.element=a,this.subElements={title:$(".arena-"+c+"-title span:not(.arena-result-item-number)",this.element),originalTitle:$(".arena-detail-original .arena-value",this.element),author:$(".arena-"+c+"-author .arena-value",this.element),publisher:$(".arena-record-publisher .arena-value",this.element),year:$(".arena-"+c+"-year .arena-value",this.element),isbns:$(".arena-"+c+"-isbn .arena-value",this.element),media:$(".arena-"+c+"-media .arena-value",this.element),lang:$(".arena-"+c+"-language .arena-value",this.element)},d=this.subElements.title.text().trim(),f=this.subElements.author.text(),g=this.subElements.publisher.text(),h=this.subElements.year.text(),k=this.subElements.media.text(),l=this.subElements.lang.text().trim(),c){case"record":i=this.subElements.isbns.text().split(", ");break;case"detail":i=[],$(this.subElements.isbns).each(function(){i.push($(this).text().trim())})}if(i)for(var n=0;n<i.length;n++){var o=i[n].replace(/-/g,"");if(13===o.length){j=o;break}}this.title=new Title(d,e),f&&(this.author={inverted:this.subElements.author.text(),lastname:this.subElements.author.text().split(",")[0].trim(),firstname:this.subElements.author.text().split(",")[1].substring(1).trim()}),g&&(this.publisher=g),h&&(this.year=m.exec(h)),k&&(this.media=k),l&&(this.lang=l),j&&(this.isbn=j),this.getSelector=function(){return c},console.log(this)}function SearchResult(){this.init(),Wicket.Ajax.registerPostCallHandler(function(){this.init()})}function Smakprov(a,b){var c=this;this.isbn=a,$.getJSON("/smakprov/v1/records?isbn="+this.isbn,c.callback(this,b))}function Title(a,b){var c,d,e,f,g,h,i;g=a,b=b||g,console.log("ti = "+g),console.log(g),console.log("ti.search = "+g.search),c=g.search("\\["),d=g.search(" :"),e=g.search("/"),f=g.search("\\[?(P\\.|Season|Series)"),d>-1&&(d+=1),e>-1&&(e+=2),h="",d>-1&&(d+=2,h=e>-1?g.substr(d,e-d-3):f>-1?g.substr(d,f-d-1):g.substr(d),h=h.replace(/[\[\]]/g,"")),i="",f>-1&&(a=g.substr(f),console.log(a),i=a.substr(a.search(/[0-9]/)),i=i.replace("]",""),a="",-1===i&&(i="")),c===f&&(c=-1),c>-1&&e>c?g=g.substr(0,c-1):d>-1&&(-1===e||e>d)?g=g.substr(0,d-3):e>-1?g=g.substr(0,e-3):f>-1&&(g=g.substr(0,f-1)),this.main=g,""!==h&&(this.sub=h),this.original=b,""!==i&&(this.part=i)}function convert10to13(a){var b,c="978",d=c.concat(a.substr(0,9)),e=d.split(""),f=0,g=0;for(f=0;f<e.length;f++){var h=3;f%2===0&&(h=1,g+=e[f]*h)}return b=10-g%10,d+b}function convert13to10(a){var b,c=a.substr(3,9),d=c.split(""),e=0,f=10,g=0;for(e=0;e<d.length;e++,f--)g+=d[e]*f;return b=11-g%11,11===b&&(b=0),10===b&&(b="X"),c+b}function truncate(a,b,c){if("undefined"==typeof b&&(b=100),"undefined"==typeof c&&(c="[...]"),a.length<b)return a;for(var d=b-1;" "!==a.charAt(d);d--)b--;return a.substr(0,b)+c}CatalogueRecord.prototype.addLnkToExtRes=function(){try{if("detail"!==this.view)throw"Only possible from the detail-view"}catch(a){console.log(a)}},CatalogueRecord.prototype.advertise=function(){try{if("list"!==this.view)throw"Only possible from the list-view"}catch(a){console.log(a)}},CatalogueRecord.prototype.hideField=function(a){$(".arena-"+this.getSelector()+"-"+a).hide()},CatalogueRecord.prototype.removeMediumFromTitle=function(){var a=this.subElements.title;a.text(a.text().replace(/\[.*\] ([\/:])/,"$1"))},CatalogueRecord.prototype.truncateTitle=function(){var a=this.title.main;this.title.part&&(a+=" "+this.title.part),this.subElements.title.html(truncate(a,30))},CatalogueRecord.prototype.getSmakprov=function(a){new Smakprov(this.isbn,a)},SearchResult.prototype.init=function(){$(".arena-library-record").each(function(){var a=new CatalogueRecord(this,"list");a.truncateTitle(),a.hideField("isbn")})},SearchResult.prototype.smakprov=function(){},SearchResult.prototype.dvdCovers=function(){},Smakprov.prototype.callback=function(a,b){return function(c){if(c.length>0)switch(console.log("type = "+b),console.log("smakprov p√• "+a.getUrl()),b){case"detail":break;case"list":}}},Smakprov.prototype.getUrl=function(){return"http://www.smakprov.se/smakprov.php?isbn="+this.isbn+"&l=vimmerby"};