/*! arenajs - v0.1.0 - 2014-11-22
* https://github.com/jnylin/arena
* Copyright (c) 2014 Jakob Nylin; Licensed GPL */
function CatalogueRecord(a,b,c){var d;switch(this.view=c,c){case"detail":d="detail";break;case"list":d="record"}this.element=a,this.subElements={title:$(".arena-"+b+"-title span:not(.arena-result-item-number)",this.element),originalTitle:$(".arena-detail-original .arena-value",this.element),author:$(".arena-"+b+"-author .arena-value",this.element),publisher:$(".arena-record-publisher .arena-value",this.element),year:$(".arena-"+b+"-year .arena-value",this.element),isbns:$(".arena-"+b+"-isbn .arena-value",this.element),media:$(".arena-"+b+"-media .arena-value",this.element),lang:$(".arena-"+b+"-language .arena-value",this.element)};var e,f,g,h,i,j,k,l,m,n=new RegExp("[0-9]{4}","i");switch(e=this.subElements.title.text().trim(),g=this.subElements.author.text(),h=this.subElements.publisher.text(),i=this.subElements.year.text(),l=this.subElements.media.text(),m=this.subElements.lang.text().trim(),b){case"record":j=this.subElements.isbns.text().split(", ");break;case"detail":j=[],$(this.subElements.isbns).each(function(){j.push($(this).text().trim())})}if(j)for(var o=0;o<j.length;o++){var p=j[o].replace(/-/g,"");if(13===p.length){k=p;break}}this.title=new Title(e,f),g&&(this.author={inverted:this.subElements.author.text(),lastname:this.subElements.author.text().split(",")[0].trim(),firstname:this.subElements.author.text().split(",")[1].substring(1).trim()}),h&&(this.publisher=h),i&&(this.year=n.exec(i)),l&&(this.media=l),m&&(this.lang=m),k&&(this.isbn=k),this.getSelector=function(){return b},console.log(this)}function SearchResult(){this.init(),Wicket.Ajax.registerPostCallHandler(function(){this.init()})}function Smakprov(a,b){var c=this;this.isbn=a,$.getJSON("/smakprov/v1/records?isbn="+this.isbn,c.callback(this,b))}function Title(a,b){var c,d,e,f,g,h,i;g=a,b=b||g,console.log("ti = "+g),console.log(g),console.log("ti.search = "+g.search),c=g.search("\\["),d=g.search(" :"),e=g.search("/"),f=g.search("\\[?(P\\.|Season|Series)"),d>-1&&(d+=1),e>-1&&(e+=2),h="",d>-1&&(d+=2,h=e>-1?g.substr(d,e-d-3):f>-1?g.substr(d,f-d-1):g.substr(d),h=h.replace(/[\[\]]/g,"")),i="",f>-1&&(a=g.substr(f),console.log(a),i=a.substr(a.search(/[0-9]/)),i=i.replace("]",""),a="",-1===i&&(i="")),c===f&&(c=-1),c>-1&&e>c?g=g.substr(0,c-1):d>-1&&(-1===e||e>d)?g=g.substr(0,d-3):e>-1?g=g.substr(0,e-3):f>-1&&(g=g.substr(0,f-1)),this.main=g,this.sub=h,this.original=b,this.part=i}function convert10to13(a){var b,c="978",d=c.concat(a.substr(0,9)),e=d.split(""),f=0,g=0;for(f=0;f<e.length;f++){var h=3;f%2===0&&(h=1,g+=e[f]*h)}return b=10-g%10,d+b}function convert13to10(a){var b,c=a.substr(3,9),d=c.split(""),e=0,f=10,g=0;for(e=0;e<d.length;e++,f--)g+=d[e]*f;return b=11-g%11,11===b&&(b=0),10===b&&(b="X"),c+b}function truncate(a,b,c){if("undefined"==typeof b&&(b=100),"undefined"==typeof c&&(c="[...]"),a.length<b)return a;for(var d=b-1;" "!==a.charAt(d);d--)b--;return a.substr(0,b)+c}CatalogueRecord.prototype.addLinkToExtRes=function(){try{if("detail"!==this.view)throw"This is only possible from the detail-view"}catch(a){console.log(a)}},CatalogueRecord.prototype.decorate=function(){},CatalogueRecord.prototype.hideField=function(a){$(".arena-"+this.getSelector()+"-"+a).hide()},CatalogueRecord.prototype.removeMediumFromTitle=function(){var a=this.subElements.title;a.text(a.text().replace(/\[.*\] ([\/:])/,"$1"))},CatalogueRecord.prototype.truncateTitle=function(){this.subElements.title.html(truncate(this.title.main+" "+this.title.part,30))},CatalogueRecord.prototype.getSmakprov=function(a){new Smakprov(this.isbn,a)},SearchResult.prototype.init=function(){$(".arena-library-record").each(function(){var a=new CatalogueRecord(this,"record");a.truncateTitle(),a.hideField("isbn")})},SearchResult.prototype.smakprov=function(){},SearchResult.prototype.dvdCovers=function(){},Smakprov.prototype.callback=function(a,b){return function(c){if(c.length>0)switch(console.log("type = "+b),console.log("smakprov p√• "+a.getUrl()),b){case"detail":break;case"list":}}},Smakprov.prototype.getUrl=function(){return"http://www.smakprov.se/smakprov.php?isbn="+this.isbn+"&l=vimmerby"};